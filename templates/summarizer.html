{% extends "layout.html" %}
{% set active_page = "summarizer" %}

{% block title %}Summarizer - pub2sum{% endblock %}

{% block teaser %}
    <h1 class="mb-3"><i class="fa-solid fa-pen-nib text-success"></i>&nbsp;Summarizer</h1>
    <p class="lead mb-4">Upload your scientific papers here. You can analyze a single PDF file or upload a ZIP file
        containing multiple PDFs at the same time.</p>

    <form action="{{ url_for('summarizer') }}" method="post" enctype="multipart/form-data" class="mb-5">
        <input type="file" name="file" id="summarizer-file-upload" class="form-control mb-3">
        <button type="submit" class="btn btn-success w-100">Summarize</button>
    </form>

    {% if input_texts or summaries or references %}
        <div class="scroll-to-results mb-5">
            <a href="#summarizer-results-section"><i class="fa-solid fa-angles-down"></i></a>
        </div>
    {% endif %}
{% endblock teaser %}

{% block content %}
    {% if input_texts or summaries or references %}
        <div id="summarizer-results-section" class="results">
            <h2 class="text-center mb-4">Results</h2>

            <div class="accordion" id="summarizer-results-accordion">
                {% if input_texts %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="summarizer-raw-input-text">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#summarizer-raw-input-text-panel" aria-expanded="false"
                                    aria-controls="summarizer-raw-input-text-panel">
                                Input Text
                            </button>
                        </h2>
                        <div id="summarizer-raw-input-text-panel" class="accordion-collapse collapse"
                             aria-labelledby="summarizer-raw-input-text">
                            <div class="accordion-body">
                                {% for input_text in input_texts %}
                                    {% for paragraph in input_text %}
                                        <p>{{ paragraph }}</p>
                                    {% endfor %}
                                    <hr/>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if summaries %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="summarizer-summary">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#summarizer-summary-panel" aria-expanded="true"
                                    aria-controls="summarizer-summary-panel">
                                Summary
                            </button>
                        </h2>
                        <div id="summarizer-summary-panel" class="accordion-collapse collapse show"
                             aria-labelledby="summarizer-summary">
                            <div class="accordion-body">
                                <pre>{{ completion_tokens }} Tokens used</pre>
                                <hr>
                                {% for summary in summaries %}
                                    <p>{{ summary }}</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if references %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="summarizer-reference-list">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#summarizer-reference-list-panel" aria-expanded="false"
                                    aria-controls="summarizer-reference-list-panel">
                                Reference List
                            </button>
                        </h2>
                        <div id="summarizer-reference-list-panel" class="accordion-collapse collapse"
                             aria-labelledby="summarizer-reference-list">
                            <div class="accordion-body">
                                <ul>
                                    {% for reference in references %}
                                        <li>{{ reference }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
{% endblock content %}